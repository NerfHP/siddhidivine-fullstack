generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// --- UPDATED User Model for Email Authentication ---
model User {
  id                String    @id @default(cuid())
  email             String    @unique // NOW REQUIRED AND UNIQUE
  name              String?
  phone             String?   @unique // NOW OPTIONAL, but unique if provided
  alternativePhone  String?
  address           String?
  isProfileComplete Boolean   @default(false)
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  tokens            Token[]
  reviews           Review[]
  orders            Order[]
  role              String    @default("user")
  // The 'password' field has been removed as it is now managed by Firebase.
}

model Token {
  id          String   @id @default(cuid())
  token       String   @unique
  type        String
  expires     DateTime
  blacklisted Boolean  @default(false)
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt   DateTime @default(now())
}

model Category {
  id          String        @id @default(cuid())
  name        String
  slug        String        @unique
  description String?
  type        String
  image       String?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  parentId    String?
  parent      Category?     @relation("ParentChild", fields: [parentId], references: [id], onDelete: Cascade)
  children    Category[]    @relation("ParentChild")
  items       ContentItem[]
}

model ContentItem {
  id              String      @id @default(cuid())
  name            String
  slug            String      @unique
  description     String
  content         String?
  price           Float?
  salePrice       Float?
  images          String
  type            String
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  categories      Category[]
  vendor          String?
  sku             String?
  availability    String?
  attributes      String?
  specifications  String?
  benefits        String?
  variants        String?
  howToUse        String?
  packageContents String?
  reviews         Review[]
  orderItems      OrderItem[]
  stock           Int         @default(0)
  isPublished     Boolean     @default(true)
  faqs            ProductFaq[]
}

model ProductFaq {
  id        String      @id @default(cuid())
  question  String
  answer    String
  productId String
  product   ContentItem @relation(fields: [productId], references: [id], onDelete: Cascade)
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt

  @@index([productId])
}

model FormSubmission {
  id        String   @id @default(cuid())
  type      String
  data      String
  createdAt DateTime @default(now())
}

model Review {
  id          String      @id @default(cuid())
  rating      Int
  comment     String?
  imageUrl    String?
  isApproved  Boolean     @default(true)
  createdAt   DateTime    @default(now())
  productId   String
  product     ContentItem @relation(fields: [productId], references: [id], onDelete: Cascade)
  userId      String?
  user        User?       @relation(fields: [userId], references: [id], onDelete: Cascade)
  guestName   String?
  guestEmail  String?
  approvedAt  DateTime?
  approvedBy  String?

  @@index([productId])
  @@index([userId])
  @@index([isApproved])
  @@index([guestEmail])
}

model Discount {
  id           String    @id @default(cuid())
  code         String    @unique
  discountType String
  value        Float
  expiresAt    DateTime?
  isActive     Boolean   @default(true)
  createdAt    DateTime  @default(now())
}

model Order {
  id              String      @id @default(cuid())
  userId          String?
  user            User?       @relation(fields: [userId], references: [id])
  total           Float
  status          String      @default("PENDING")
  customerName    String
  customerPhone   String
  shippingAddress String
  items           OrderItem[]
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
}

model OrderItem {
  id        String      @id @default(cuid())
  quantity  Int
  price     Float
  orderId   String
  order     Order       @relation(fields: [orderId], references: [id], onDelete: Cascade)
  productId String
  product   ContentItem @relation(fields: [productId], references: [id])
}

